class pjTailwind{constructor(){this.activeLayer=null,this.backdropEl=null,this.drawerState=new Map,this.layerStack=[],this._raf=null,this._bindEvents(),this._initDrawers()}open(e,t="modal",s=null){const a="string"==typeof e?document.querySelector(e):e;a&&this._openLayer(a,t,s)}close(e){const t="string"==typeof e?document.querySelector(e):e;t&&this._closeLayer(t)}toggle(e,t="modal",s=null){const a="string"==typeof e?document.querySelector(e):e;a&&(this._isOpen(a)?this._closeLayer(a):this._openLayer(a,t,s))}closeAll(){[...this.layerStack].reverse().forEach((e=>this._closeLayer(e)))}_bindEvents(){this._clickHandler=e=>this._handleClick(e),this._keyHandler=e=>this._handleKeydown(e),document.addEventListener("click",this._clickHandler),document.addEventListener("keydown",this._keyHandler)}_handleClick(e){const t=e.target,s=[{attr:"data-modal",type:"modal"},{attr:"data-offcanvas",type:"offcanvas"},{attr:"data-drawer",type:"drawer"}];for(const{attr:a,type:n}of s){const s=t.closest(`[${a}]`);if(s){e.preventDefault();const t=s.getAttribute(a);return void this.open(t,n,s)}}if(t.classList.contains("btn-close")||t.classList.contains("close")){const e=t.closest(".modal, .offcanvas, .drawer");if(e)return void this.close(e)}if(t.classList.contains("offcanvas-backdrop")||t.classList.contains("drawer-backdrop"))return void(this.activeLayer&&this.close(this.activeLayer));const a=t.closest(".modal");a&&this._isOpen(a)&&!t.closest(".modal-content, .offcanvas")&&this.close(a)}_handleKeydown(e){"Escape"===e.key&&this.activeLayer&&(e.preventDefault(),this.close(this.activeLayer))}_openLayer(e,t,s=null){if(this._isOpen(e))return;t&&"modal"!==t||(t=e.classList.contains("drawer")?"drawer":e.classList.contains("offcanvas")?"offcanvas":"modal"),"offcanvas"!==t&&"drawer"!==t||this._createBackdrop(e,t),"modal"===t&&(e.style.display="block",e.offsetHeight,e.dispatchEvent(new CustomEvent("pjmodal:show",{detail:{trigger:s},bubbles:!0}))),"drawer"===t&&(this._initDrawerDrag(e),e.dispatchEvent(new CustomEvent("pjdrawer:show",{detail:{caller:s},bubbles:!0}))),"offcanvas"===t&&e.dispatchEvent(new CustomEvent("pjoffcanvas:show",{detail:{trigger:s},bubbles:!0}));const a="drawer"===t?"open":"show";this._raf=requestAnimationFrame((()=>{e.classList.add(a),e.setAttribute("aria-hidden","false"),!1===e.hasAttribute("tabindex")&&e.setAttribute("tabindex","-1"),e.focus({preventScroll:!0})})),document.body.style.overflow="hidden",this.activeLayer=e,this.layerStack.push(e),e.dataset.pjType=t}_closeLayer(e){if(!this._isOpen(e))return;const t=e.dataset.pjType||"modal",s="drawer"===t,a=s?"open":"show";e.classList.remove(a),e.setAttribute("aria-hidden","true"),s&&(e.style.transform="",this._cleanupDrawerDrag(e));const n=this.layerStack.indexOf(e);n>-1&&this.layerStack.splice(n,1),0===this.layerStack.length&&(document.body.style.overflow="");const r=()=>{e.removeEventListener("transitionend",r),e.classList.remove("hiding"),"modal"===t?(e.style.display="none",e.dispatchEvent(new CustomEvent("pjmodal:hide",{bubbles:!0}))):"drawer"===t?e.dispatchEvent(new CustomEvent("pjdrawer:hide",{bubbles:!0})):"offcanvas"===t&&e.dispatchEvent(new CustomEvent("pjoffcanvas:hide",{bubbles:!0})),this._removeBackdrop(),this.activeLayer===e&&(this.activeLayer=this.layerStack[this.layerStack.length-1]||null),delete e.dataset.pjType};e.classList.add("hiding"),e.addEventListener("transitionend",r,{once:!0});const i=1e3*parseFloat(getComputedStyle(e).transitionDuration);0===i?r():setTimeout(r,i+50)}_createBackdrop(e,t){if(this.backdropEl)return;const s=document.createElement("div");s.className="drawer"===t?"drawer-backdrop offcanvas-backdrop":"offcanvas-backdrop",s.setAttribute("aria-hidden","true"),e.parentNode?.insertBefore(s,e),this._raf=requestAnimationFrame((()=>{s.classList.add("opacity-100")})),this.backdropEl=s}_removeBackdrop(){if(!this.backdropEl)return;const e=this.backdropEl;e.classList.remove("opacity-100"),e.classList.add("opacity-0");const t=()=>{e.parentNode&&e.remove(),this.backdropEl=null};e.addEventListener("transitionend",t,{once:!0});const s=1e3*parseFloat(getComputedStyle(e).transitionDuration);0===s?t():setTimeout(t,s+50)}_initDrawers(){document.querySelectorAll(".drawer").forEach((e=>{e.parentElement!==document.body&&document.body.appendChild(e)}))}_initDrawerDrag(e){if(this.drawerState.has(e))return;const t={startY:0,currentY:0,isDragging:!1,initialTransition:e.style.transition},s=s=>{if(!this._isOpen(e))return;const a=s.type.startsWith("touch")?s.touches[0].clientY:s.clientY;t.startY=a,t.currentY=a,t.isDragging=!0,t.initialTransition=e.style.transition,e.style.transition="none",e.style.willChange="transform"},a=s=>{if(!t.isDragging)return;s.preventDefault();const a=s.type.startsWith("touch")?s.touches[0].clientY:s.clientY;t.currentY=a;const n=t.currentY-t.startY;n>0&&(this._raf=requestAnimationFrame((()=>{e.style.transform=`translateY(${n}px)`})))},n=()=>{if(!t.isDragging)return;t.isDragging=!1,e.style.transition=t.initialTransition,e.style.willChange="";t.currentY-t.startY>100?this.close(e):e.style.transform=""},r={onStart:s,onMove:a,onEnd:n,state:t};this.drawerState.set(e,r),e.addEventListener("touchstart",s,{passive:!0}),e.addEventListener("mousedown",s),document.addEventListener("touchmove",a,{passive:!1}),document.addEventListener("mousemove",a),document.addEventListener("touchend",n,{passive:!0}),document.addEventListener("mouseup",n)}_cleanupDrawerDrag(e){const t=this.drawerState.get(e);t&&(e.removeEventListener("touchstart",t.onStart),e.removeEventListener("mousedown",t.onStart),document.removeEventListener("touchmove",t.onMove),document.removeEventListener("mousemove",t.onMove),document.removeEventListener("touchend",t.onEnd),document.removeEventListener("mouseup",t.onEnd),this.drawerState.delete(e))}_isOpen(e){return e.classList.contains("show")||e.classList.contains("open")}destroy(){this._raf&&cancelAnimationFrame(this._raf),document.removeEventListener("click",this._clickHandler),document.removeEventListener("keydown",this._keyHandler),this.drawerState.forEach(((e,t)=>{this._cleanupDrawerDrag(t)})),this.closeAll(),this.drawerState.clear(),this.layerStack=[]}}const pjtail=new pjTailwind;"undefined"!=typeof module&&module.exports&&(module.exports=pjTailwind);