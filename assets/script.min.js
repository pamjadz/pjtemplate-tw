async function arvandOtpAjax(e,t,a=null){const n=new FormData;n.append("action","arvand_otp"),n.append("nonce",t),n.append("method",e);for(const e in a)a.hasOwnProperty(e)&&n.append(e,a[e]);try{const e=await fetch(ajaxURL,{method:"POST",credentials:"same-origin",body:n});if(!e.ok)throw new Error(`HTTP error ${e.status}`);const t=await e.json();return t}catch(e){return{success:!1,data:{message:e.message||"خطا در ارتباط با سرور"}}}}const themejs=document.getElementById("themejs"),ajaxURL=themejs.dataset.ajax;document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".splide").forEach(e=>{e.dataset.splide&&new Splide(e).mount()})}),"undefined"!=typeof jQuery&&jQuery(document).ready(function(e){e(document).on("submit",".form-arvandOTP",function(t){t.preventDefault();const a=e(this).find('[name="nonce"]').val(),n=e(this).find('[name="method"]').val();(async()=>{let t=null;t="authcode"==n?await arvandOtpAjax("checkcode",a,{authcode:e(this).find('[name="authcode"]').val()}):await arvandOtpAjax("sendcode",a,{username:e(this).find('[name="username"]').val()}),"loggedin"===t.status?document.dispatchEvent(new CustomEvent("arvandOTP_loggedin",{detail:{user:t.user,message:t.message,target:this}})):t.status&&e(this).find("fieldset").fadeOut(function(){e(this).html(t.fragment).fadeIn()}),t.message.length>0&&showToast(t.message,t.status?"success":"error",5e3)})()}),e(document).on("arvandOTP_loggedin",function(e){window.location.reload()}),e(document).on("click",".btn-collapse",function(t){t.preventDefault();const a=e(this),n=a.attr("aria-controls");if(!n)return void console.error("خطا: aria-controls تعریف نشده است");const s=e("#"+n);if(!s.length)return void console.error(`خطا: المان با ID "${n}" یافت نشد`);const o=a.closest(".tablist");if(o.length)o.find(".btn-collapse").attr("aria-selected","false"),o.find('[role="tabpanel"]').addClass("hidden"),a.attr("aria-selected","true"),s.removeClass("hidden");else{const e="true"===a.attr("aria-expanded"),t=a.closest(".accordion");t.length&&t.hasClass("accordion-single")&&t.find(".btn-collapse").not(a).attr("aria-expanded","false"),a.attr("aria-expanded",e?"false":"true"),s.toggleClass("hidden",e)}})});