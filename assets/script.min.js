async function arvandOtpAjax(e,t,a=null){const n=new FormData;n.append("action","arvand_otp"),n.append("nonce",t),n.append("method",e);for(const e in a)a.hasOwnProperty(e)&&n.append(e,a[e]);try{const e=await fetch(ajaxURL,{method:"POST",credentials:"same-origin",body:n});if(!e.ok)throw new Error(`HTTP error ${e.status}`);const t=await e.json();return t}catch(e){return{success:!1,data:{message:e.message||"خطا در ارتباط با سرور"}}}}const themejs=document.getElementById("themejs"),ajaxURL=themejs.dataset.ajax;document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".splide").forEach(e=>{e.dataset.splide&&new Splide(e).mount()})}),"undefined"!=typeof jQuery&&jQuery(document).ready(function(e){e(document).on("submit",".form-arvandOTP",function(t){t.preventDefault();const a=e(this).find('[name="nonce"]').val(),n=e(this).find('[name="method"]').val();(async()=>{let t=null;t="authcode"==n?await arvandOtpAjax("checkcode",a,{authcode:e(this).find('[name="authcode"]').val()}):await arvandOtpAjax("sendcode",a,{username:e(this).find('[name="username"]').val()}),"loggedin"===t.status?document.dispatchEvent(new CustomEvent("arvandOTP_loggedin",{detail:{user:t.user,message:t.message,target:this}})):t.status&&e(this).find("fieldset").fadeOut(function(){e(this).html(t.fragment).fadeIn()}),t.message.length>0&&showToast(t.message,t.status?"success":"error",5e3)})()}),e(document).on("arvandOTP_loggedin",function(e){window.location.reload()}),e(document).on("click",".btn-collapse",function(t){t.preventDefault();const a=e(this),n=a.attr("aria-controls");if(!n)return void console.error("خطا: aria-controls تعریف نشده است");const s=e("#"+n);if(!s.length)return void console.error(`خطا: المان با ID "${n}" یافت نشد`);const o=a.closest(".tablist");if(o.length)o.find(".btn-collapse").attr("aria-selected","false"),o.find('[role="tabpanel"]').addClass("hidden"),a.attr("aria-selected","true"),s.removeClass("hidden");else{const e="true"===a.attr("aria-expanded"),t=a.closest(".accordion");t.length&&t.hasClass("accordion-single")&&t.find(".btn-collapse").not(a).attr("aria-expanded","false"),a.attr("aria-expanded",e?"false":"true"),s.toggleClass("hidden",e)}}),e(document).on("click","[data-ilikeit] button",function(t){t.preventDefault();const a=e(this),n=a.closest("[data-ilikeit]"),s=n.data("ilikeit").split(":");a.hasClass("btn-like")?s.push("like"):s.push("dislike"),n.find("button").prop("disabled",!0).find(".count").html("&hellip;"),e.post(ajaxURL,{action:"entry_user_reaction",params:s},function(e){e.success?(n.find(".btn-like .count").html(e.data.like),n.find(".btn-dislike .count").html(e.data.dislike),a.toggleClass("fill")):alert(e.data)}),n.find("button").prop("disabled",!1)}),document.querySelectorAll("[data-scrollspy]").forEach(e=>{const t=document.getElementById(e.dataset.scrollspy);if(!t)return void console.error("Scrollspy wrapper not found for:",e.dataset.scrollspy);const a=[...e.querySelectorAll("a")];if(0===a.length)return void console.warn("No items found inside:",e);const n=a[0];n.classList.add("is-active");let s=!1;window.addEventListener("scroll",()=>{s||(window.requestAnimationFrame(()=>{const o=document.querySelector(n.hash);if(!o)return;const i=o.offsetTop-t.offsetHeight;window.pageYOffset<=i?(a.forEach(e=>e.classList.remove("is-active")),n.classList.add("is-active"),e.scrollLeft=n.offsetLeft-e.offsetLeft):a.forEach(t=>{const n=document.querySelector(t.hash);if(!n)return;const s=n.offsetTop-100,o=s+n.offsetHeight;window.pageYOffset>=s&&window.pageYOffset<=o&&(a.forEach(e=>e.classList.remove("is-active")),t.classList.add("is-active"),e.scrollLeft=t.offsetLeft-e.offsetLeft)}),s=!1}),s=!0)})})});